USE WORLD;

CREATE TABLE CUSTOMER_RISK_RESULT(
  ID              BIGINT  NOT NULL AUTO_INCREMENT COMMENT 'ID'
 ,BASE_YYMM       CHAR(4) NOT NULL COMMENT '기준년월'
 ,CUSTOMER_ID     BIGINT  NOT NULL COMMENT '고객ID'
 ,RISK_SCORE      INT     NOT NULL COMMENT '위험점수'
 ,RISK_GRADE      CHAR(1) NOT NULL COMMENT '위험등급'
 ,PRIMARY KEY (ID)
 ,KEY CUSTOMER_RISK_RESULT_IX1 (CUSTOMER_ID, BASE_YYMM)
);

CREATE TABLE GRADE_BASE(
  ID              INT     NOT NULL COMMENT 'ID'
 ,GRADE           CHAR(1) NOT NULL COMMENT '등급'
 ,MIN_SCORE       INT     NOT NULL COMMENT '최저점수'
 ,MAX_SCORE       INT     NOT NULL COMMENT '최고점수'
 ,PRIMARY KEY (ID)
 ,KEY GRADE_BASE (MIN_SCORE, MAX_SCORE)
);

INSERT INTO GRADE_BASE VALUES (1, 'A', 71, 100);
INSERT INTO GRADE_BASE VALUES (2, 'B', 31,  70);
INSERT INTO GRADE_BASE VALUES (3, 'C',  0,  30);

/*
월/고객별 거래금액 집계 중간 테이블
*/
CREATE TABLE MONTHLY_CUSTOMER_AMOUNT(
  BASE_YYMM     CHAR(4) NOT NULL COMMENT '기준년월'
 ,CUSTOMER_ID   BIGINT  NOT NULL COMMENT '고객ID'
 ,TOTAL_AMOUNT  BIGINT  NOT NULL COMMENT '월별 거래금액합계'
 ,PRIMARY KEY (BASE_YYMM, CUSTOMER_ID)
 );

CREATE TABLE CUSTOMER (
  CUSTOMER_ID   BIGINT  NOT NULL COMMENT '고객ID'
 ,NAME          VARCHAR(10)      COMMENT '고객명'
 ,BIRTHDAY      CHAR(8)          COMMENT '생년월일'
 ,NATIONALITY   CHAR(2)          COMMENT '국적'
 ,PRIMARY KEY (CUSTOMER_ID)
 );
 
 
CREATE TABLE TRANSACTION (
  TRANSACTION_ID   BIGINT NOT NULL COMMENT 'ID'
 ,TRANSACTION_DATE TIMESTAMP NOT NULL COMMENT '거래일시'
 ,CUSTOMER_ID      BIGINT NOT NULL  COMMENT '고객ID'
 ,AMOUNT           BIGINT NOT NULL  COMMENT '거래금액'
 ,PRIMARY KEY (TRANSACTION_ID)
 ,KEY TRANSACTION_IX1 (TRANSACTION_DATE, CUSTOMER_ID)
 );